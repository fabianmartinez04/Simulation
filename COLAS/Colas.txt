/*
Tecnológico de Costa Rica
Curso de Simulación 
Tarea programada de Inventario con Colas
Fabian Martínez Valverde 2019061575
Gustavo Blanco Alfaro 2019063503

Solución con:

3 empleados:
4 empleados:
5 empleados:
6 empleados:

*/


'Función para obtener la cantidad de camiones en espera al inicio de la simulación
newcmd obtenerCamionesEspera cantidad
	copy 50#0 25#1 15#2 10#3 tabla
	sample 1 tabla cantidad
end



'Función para obtener la media según la cantidad de empleados
newcmd obtenerMedia empleados media
	if empleados = 3
		media = 37
	elseif empleados = 4
		media = 35
	elseif empleados = 5
		media = 33
	elseif empleados = 6
		media = 31
	else
		media = -1
	end
end


'Función para obtener la siguiente entrada de un camión
newcmd obtenerEntrada tiempo
   exponential 1 40 tiempo
   integer ceiling tiempo tiempo
end


'Función para obtener la salida de un camión según la cantidad de empleados
newcmd obtenerSalida promedio tiempo
   exponential 1 promedio tiempo
   integer ceiling tiempo tiempo
end









/***********************************************************************
			MAIN
***********************************************************************/

clearoutput

input "Cantidad de empleados: " empleados

obtenerMedia empleados media

if media = -1
	print "Los empleados deben ser de 3 a 6"
else

	obtenerCamionesEspera contCamiones
	print contCamiones
	print "\n"


	'Preparación de listas
	Tiempo = ()
	Evento = ()
	Sig_Salida = ()
	Cola = ()
	Sig_Entrada = ()
	T_Ocioso = ()
	T_Esp_Bus = ()


	'Preparación de variables
	NAME Inicio Salida Entrada Fin x

	TiempoActual = 0
	TiempoAnterior = 0
	TiempoDif = 0
	EventoActual = Inicio
	SalActual = 0
	SalAnterior = 0
	ColaActual = ()
	EntActual = 0
	T_OciosoActual = 0
	T_Esp_BusActual = 0

	tamColaActual = 0
	

	until EntActual >= 480 AND contCamiones = 0

		size ColaActual tamColaActual

		concat Tiempo TiempoActual Tiempo
		concat Evento EventoActual Evento

		TiempoDif = TiempoActual - TiempoAnterior


		if SalActual = 9999
			T_OciosoActual = TiempoDif
			concat T_Ocioso T_OciosoActual T_Ocioso
		else
			concat T_Ocioso 0 T_Ocioso
		end


		if EventoActual <> Salida
			obtenerEntrada EntActual
			EntActual = TiempoActual + EntActual
		end
		
		if EntActual > 480
			'Agregue algo para identificar que ya no se recibe
		end


		concat Sig_Entrada EntActual Sig_Entrada


		if (contCamiones > 0 AND EventoActual = Salida) OR contCamiones > 0
			obtenerSalida media SalActual
			SalActual = TiempoActual + SalActual
			concat Sig_Salida SalActual Sig_Salida

		else
			SalActual = 9999
			concat Sig_Salida x Sig_Salida
		end



		'Hace los calculos con las colas
		if salAnterior = salActual
			concat ColaActual 0 ColaActual
		end


		concat Cola ColaActual Cola

		
		'Asigna las variables para la iteración anterior
		TiempoAnterior = TiempoActual
		salAnterior = salActual
		
		if EntActual < SalActual AND EntActual <= 480
			TiempoActual = EntActual
			EventoActual = Entrada
			contCamiones = contCamiones + 1
		else
			TiempoActual = SalActual
			EventoActual = Salida
			contCamiones = contCamiones - 1
		end
		

		
		
		
	end

	print table Tiempo%8.4f Evento Sig_Salida%8.4f Sig_Entrada%8.4f T_Ocioso%8.4f T_Esp_Bus%8.4f Cola%8.4F

end






